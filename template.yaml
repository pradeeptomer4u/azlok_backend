AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31
Description: FastAPI + Mangum serverless app (HTTP API)

Globals:
  Function:
    Runtime: python3.13
    Timeout: 15
    MemorySize: 512

Resources:
  FastApiFunction:
    Type: AWS::Serverless::Function
    Properties:
      FunctionName: fastapi-mangum
      Handler: main.handler
      CodeUri: .
      AutoPublishAlias: live
      Policies:
        - AWSLambdaVPCAccessExecutionRole
      Environment:
        Variables:
          ENV: production
      VpcConfig:
        SubnetIds:
          - subnet-053c56d790725d05c
          - subnet-00de03a2cb72415c6
          - subnet-0f9338d0bcd52ba8d
        SecurityGroupIds:
          - sg-0e278ebcb748f1047
          - sg-0b0a134157ab5def3
      Events:
        ProxyApi:
          Type: HttpApi
          Properties:
            Path: /{proxy+}
            Method: ANY

Outputs:
  HttpApiUrl:
    Description: "HTTP API endpoint"
    Value: !Sub "https://${ServerlessHttpApi}.execute-api.${AWS::Region}.amazonaws.com/"
